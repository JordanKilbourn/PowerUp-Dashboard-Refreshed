<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PowerUp Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="style.css" rel="stylesheet" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
</head>
<body>
  <div class="page-wrap">
    <!-- Top cards -->
    <div class="cards">
      <div class="card" id="ph-card">
        <div class="card-title">Power Hours Logged</div>
        <div class="phbar">
          <div class="phbar__track">
            <div class="phbar__fill" style="width:0%"></div>
            <div class="phbar__thumb" style="left:0%"></div>
          </div>
          <div class="phbar__labels">
            <span data-hook="ph-now">0</span> / <span data-hook="ph-max">—</span>
          </div>
        </div>
        <div class="muted" data-hook="ph-msg">Loading…</div>
      </div>

      <div class="card">
        <div class="card-title">Tokens</div>
        <div class="big" data-hook="token-total">0</div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" data-tab="ci">Continuous Improvement</button>
      <button class="tab" data-tab="safety">Safety Concerns</button>
      <button class="tab" data-tab="quality">Quality Catches</button>
    </div>

    <!-- CI -->
    <section class="panel active" data-panel="ci">
      <div class="panel-header">
        <div class="title">Continuous Improvement (CI)</div>
        <div class="controls">
          <select data-filter="ci-status">
            <option>All</option><option>Pending</option><option>Approved</option><option>Denied</option><option>Closed</option>
          </select>
          <button class="btn">+ Add Submission</button>
          <span class="muted"><span data-count="ci">0</span> submissions</span>
        </div>
      </div>
      <div class="table-card">
        <div class="table-scroll">
          <table data-table="ci">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Safety -->
    <section class="panel" data-panel="safety">
      <div class="panel-header">
        <div class="title">Safety Concerns</div>
        <div class="controls">
          <select data-filter="safety-status">
            <option>All</option><option>Open</option><option>Pending</option><option>Closed</option><option>Rejected</option>
          </select>
          <button class="btn">+ Add Submission</button>
          <span class="muted"><span data-count="safety">0</span> submissions</span>
        </div>
      </div>
      <div class="table-card">
        <div class="table-scroll">
          <table data-table="safety">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Quality -->
    <section class="panel" data-panel="quality">
      <div class="panel-header">
        <div class="title">Quality Catches</div>
        <div class="controls">
          <select data-filter="quality-status">
            <option>All</option><option>Open</option><option>Pending</option><option>Closed</option><option>Rejected</option>
          </select>
          <button class="btn">+ Add Submission</button>
          <span class="muted"><span data-count="quality">0</span> submissions</span>
        </div>
      </div>
      <div class="table-card">
        <div class="table-scroll">
          <table data-table="quality">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
  </div>

  <!-- ===== JS ===== -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js" defer></script>
  <script src="scripts/api.js"></script>
  <script src="scripts/session.js"></script>
  <script src="scripts/layout.js"></script>
  <script src="scripts/tables.js"></script>
  <script src="scripts/progress.js"></script>
  <script src="scripts/tokens.js"></script>
  <script>
    // simple tab switcher
    function wireTabs(){
      const tabs = document.querySelectorAll('.tab');
      const panels = document.querySelectorAll('.panel');
      tabs.forEach(t=>{
        t.addEventListener('click', ()=>{
          tabs.forEach(x=>x.classList.remove('active'));
          panels.forEach(p=>p.classList.remove('active'));
          t.classList.add('active');
          document.querySelector(`[data-panel="${t.dataset.tab}"]`).classList.add('active');
        });
      });
    }

    document.addEventListener('DOMContentLoaded', async () => {
      PowerUp.session.requireLogin();
      PowerUp.layout.injectLayout();
      await PowerUp.session.initHeader();
      wireTabs();
      // your existing modules will populate cards + tables
      if (window.PowerUp.progress?.renderDashboardPowerHours) PowerUp.progress.renderDashboardPowerHours();
      if (window.PowerUp.tokens?.renderTokenCard) PowerUp.tokens.renderTokenCard();
      PowerUp.tables.hydrateDashboardTables();
    });
  </script>
</body>
</html>
