<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PowerUp Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts / Icons / Base styles -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="style.css" />
</head>

<!-- NOTE: no embedded sidebar/header here. layout.js injects them. -->
<body class="dashboard">

  <!-- Page content only -->
  <div class="page-wrap content">
    <!-- Title / user line shows in the injected header automatically -->
    <div class="top-cards">
      <!-- Power Hours -->
      <div class="card power-card">
        <h3>Power Hours Logged</h3>
        <p>
          <span data-hook="ph-now">0.0</span> /
          <span data-hook="ph-max">8</span>
        </p>

        <!-- Simple progress bar -->
        <div class="phbar" role="progressbar" aria-valuemin="0" aria-valuemax="8" aria-valuenow="0">
          <div class="phbar__fill"></div>
          <div class="phbar__thumb" title="Current"></div>
        </div>

        <small class="ph-msg" data-hook="ph-msg">â€”</small>
      </div>

      <!-- Tokens -->
      <div class="card token-card">
        <h3>Tokens</h3>
        <div class="token-tracker">
          <i class="fas fa-coins"></i>
          <span data-hook="token-total">0</span>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tab-buttons">
      <button class="tab-button active" data-tab="ci">Continuous Improvement</button>
      <button class="tab-button" data-tab="safety">Safety Concerns</button>
      <button class="tab-button" data-tab="quality">Quality Catches</button>
    </div>

    <!-- CI Tab -->
    <div class="tab-panel active" data-panel="ci">
      <div class="table-header-row">
        <h3>Continuous Improvement (CI)</h3>
        <div class="table-header-controls">
          <select id="ci-filter">
            <option value="all">All Statuses</option>
            <option value="approved">Approved</option>
            <option value="pending">Pending</option>
            <option value="denied">Denied</option>
            <option value="not started">Not Started</option>
            <option value="completed">Completed</option>
          </select>
          <button class="add-btn">+ Add Submission</button>
          <span id="ci-count" class="row-count">0 submissions</span>
        </div>
      </div>

      <div class="table-scroll">
        <table id="ci-table" class="dashboard-table">
          <thead>
            <tr>
              <th>Submitted</th>
              <th>ID</th>
              <th>Problem</th>
              <th>Improvement</th>
              <th>Approval</th>
              <th>Assigned</th>
              <th>Status</th>
              <th>Action Entered</th>
              <th>Last Action</th>
              <th>Resourced</th>
              <th>Resourced On</th>
              <th>Tokens</th>
              <th>Paid</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Safety Tab -->
    <div class="tab-panel" data-panel="safety">
      <div class="table-header-row">
        <h3>Safety Concerns</h3>
        <div class="table-header-controls">
          <select id="safety-filter">
            <option value="all">All Statuses</option>
            <option value="accepted">Accepted</option>
            <option value="pending">Pending</option>
            <option value="denied">Denied</option>
            <option value="closed">Closed</option>
            <option value="open">Open</option>
          </select>
          <button class="add-btn">+ Add Submission</button>
          <span id="safety-count" class="row-count">0 submissions</span>
        </div>
      </div>

      <div class="table-scroll">
        <table id="safety-table" class="dashboard-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Department/Area</th>
              <th>Safety Concern</th>
              <th>Description</th>
              <th>Recommendations</th>
              <th>Resolution</th>
              <th>Escalated To</th>
              <th>Leadership Update</th>
              <th>Closed/Confirmed</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Quality Catches Tab -->
    <div class="tab-panel" data-panel="quality">
      <div class="table-header-row">
        <h3>Quality Catches</h3>
        <div class="table-header-controls">
          <select id="quality-filter">
            <option value="all">All</option>
            <option value="pending">Pending</option>
            <option value="closed">Closed</option>
            <option value="open">Open</option>
          </select>
          <button class="add-btn">+ Add Submission</button>
          <span id="quality-count" class="row-count">0 submissions</span>
        </div>
      </div>

      <div class="table-scroll">
        <table id="quality-table" class="dashboard-table">
          <thead>
            <tr>
              <th>Catch ID</th>
              <th>Entry Date</th>
              <th>Submitted By</th>
              <th>Area</th>
              <th>Quality Catch</th>
              <th>Part Number</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- App scripts -->
  <script src="scripts/api.js"></script>
  <script src="scripts/session.js"></script>
  <script src="scripts/layout.js"></script>
  <script src="scripts/progress.js"></script>
  <script src="scripts/tokens.js"></script>
  <script src="scripts/tables.js"></script>

  <!-- Initialize -->
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      PowerUp.session.requireLogin();
      PowerUp.layout.injectLayout();
      await PowerUp.session.initHeader();

      // Tabs
      const tabs = document.querySelectorAll('.tab-button');
      const panels = document.querySelectorAll('.tab-panel');
      tabs.forEach(btn => {
        btn.addEventListener('click', () => {
          tabs.forEach(b => b.classList.remove('active'));
          panels.forEach(p => p.classList.remove('active'));
          btn.classList.add('active');
          document.querySelector(`[data-panel="${btn.dataset.tab}"]`).classList.add('active');
        });
      });

      // Cards + tables
      if (window.PowerUp.progress?.renderDashboardPowerHours) {
        await PowerUp.progress.renderDashboardPowerHours();
      }
      if (window.PowerUp.tokens?.renderTokenCard) {
        await PowerUp.tokens.renderTokenCard();
      }
      if (window.PowerUp.tables?.hydrateDashboardTables) {
        await PowerUp.tables.hydrateDashboardTables();
      }
      document.dispatchEvent(new Event('data-hydrated'));
    });
  </script>
</body>
</html>
