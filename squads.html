<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PowerUp — Squads</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="style.css" rel="stylesheet" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
</head>
<body>
  <div class="page-wrap">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <div class="title">Squads</div>
        <div class="muted">Signed in as <span data-hook="userName">—</span> · <span data-hook="userLevel">—</span></div>
      </div>
      <button class="btn" id="add">+ New Squad</button>
    </div>

    <div class="cards" id="grid" style="margin-top:12px;"></div>
  </div>

  <!-- ===== JS ===== -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js" defer></script>
  <script src="scripts/api.js"></script>
  <script src="scripts/session.js"></script>
  <script src="scripts/layout.js"></script>
  <script>
    // DEV scaffold (localStorage). We'll replace with Smartsheet (master+members) later.
    const KEY='pu.squads';
    function load(){ try{ return JSON.parse(localStorage.getItem(KEY)||'[]'); }catch{ return []; } }
    function save(a){ localStorage.setItem(KEY, JSON.stringify(a)); }
    function render(){
      const grid=document.getElementById('grid');
      const squads = load();
      if (!squads.length){ grid.innerHTML = `<div class="card">No squads yet.</div>`; return; }
      grid.innerHTML = squads.map(s=>`
        <div class="card" style="min-width:260px;flex:0 0 320px;">
          <div class="card-title">${s.name}</div>
          <div class="muted">Category: ${s.category||'—'}</div>
          <div class="muted">Lead: ${s.lead||'—'}</div>
          <div class="muted">Members: ${Array.isArray(s.members)?s.members.length:0}</div>
          <div style="margin-top:8px;display:flex;gap:8px;">
            <button class="btn" data-act="view" data-id="${s.id}">View</button>
            <button class="btn" data-act="del" data-id="${s.id}">Delete</button>
          </div>
        </div>
      `).join('');
      grid.querySelectorAll('button[data-act]').forEach(b=>{
        const id=b.dataset.id, act=b.dataset.act;
        b.addEventListener('click', ()=>{
          const arr=load();
          if (act==='del'){ save(arr.filter(x=>x.id!==id)); render(); }
          if (act==='view'){ alert('Details page TBD (will use Smartsheet)'); }
        });
      });
    }

    document.addEventListener('DOMContentLoaded', async ()=>{
      PowerUp.session.requireLogin();
      PowerUp.layout.injectLayout();
      await PowerUp.session.initHeader();
      render();
      document.getElementById('add').addEventListener('click', ()=>{
        const name = prompt('Squad name?'); if (!name) return;
        const arr=load();
        arr.push({ id: 'SQ-' + (Date.now()), name, category:'CI', lead: PowerUp.session.get().displayName, members: [] });
        save(arr); render();
      });
    });
  </script>
</body>
</html>
